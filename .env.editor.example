# ===== Core =====
N8N_ENCRYPTION_KEY=troque_por_uma_chave_grande_e_secreta
EXECUTIONS_MODE=queue

# ===== Domínio / Proxy =====
# Troque para o domínio público da Railway ou seu custom domain
N8N_HOST=seuapp.up.railway.app
N8N_PROTOCOL=https
N8N_EDITOR_BASE_URL=https://seuapp.up.railway.app
N8N_PROXY_HOPS=1
WEBHOOK_URL=https://seuapp.up.railway.app/

# ===== Postgres =====
DB_TYPE=postgresdb
DB_POSTGRESDB_HOST=<host_pg>
DB_POSTGRESDB_PORT=5432
DB_POSTGRESDB_DATABASE=<db>
DB_POSTGRESDB_USER=<user>
DB_POSTGRESDB_PASSWORD=<pass>
DB_POSTGRESDB_SSL_ENABLED=true

# ===== Fila (Valkey/Redis-compatible) =====
# Primary também precisa dessas envs porque ele ENFILEIRA as execuções
QUEUE_BULL_REDIS_HOST=<host_valkey>
QUEUE_BULL_REDIS_PORT=6379
QUEUE_BULL_REDIS_PASSWORD=<senha_ou_vazio>
# QUEUE_BULL_REDIS_TLS=true   # se for instância com TLS

# ===== Segurança (recomendado) =====
N8N_SECURE_COOKIE=true
N8N_PUBLIC_API_DISABLED=true
N8N_PUBLIC_API_SWAGGERUI_DISABLED=true

# ===== (Opcional) SMTP para convites/reset de senha =====
# N8N_EMAIL_MODE=smtp
# N8N_SMTP_HOST=...
# N8N_SMTP_PORT=587
# N8N_SMTP_USER=...
# N8N_SMTP_PASS=...
# N8N_SMTP_SENDER=Seu Nome <no-reply@seudominio.com>



# EDITOR
# Root Director[UI Railway]: apps/editor
# Healthckeck: /healthz
# Volume: /home/node/.n8n 
# Start Command[UI Railway]: n8n start
# ENV:

# Core
EXECUTIONS_MODE="queue"
N8N_ENCRYPTION_KEY="<SUA_CHAVE>"
NODE_ENV="production"
N8N_LOG_LEVEL="info"
N8N_PAYLOAD_SIZE_MAX="16"
GENERIC_TIMEZONE="America/Sao_Paulo"
N8N_ENFORCE_SETTINGS_FILE_PERMISSIONS="true"

# URLs (use o domínio público deste serviço e do webhook)
N8N_HOST="${RAILWAY_PUBLIC_DOMAIN}"
N8N_PROTOCOL="https"
N8N_EDITOR_BASE_URL="https://${RAILWAY_PUBLIC_DOMAIN}/"
N8N_PROXY_HOPS="1"
WEBHOOK_URL="https://<DOMINIO_DO_SERVICO_WEBHOOK>"   # <- importante

# Banco (Postgres)
DB_TYPE="postgresdb"
DB_POSTGRESDB_HOST="${Postgres.PGHOST}"
DB_POSTGRESDB_PORT="${Postgres.PGPORT}"
DB_POSTGRESDB_DATABASE="${Postgres.POSTGRES_DB}"
DB_POSTGRESDB_USER="${Postgres.POSTGRES_USER}"
DB_POSTGRESDB_PASSWORD="${Postgres.POSTGRES_PASSWORD}"
DB_POSTGRESDB_SCHEMA="public"
DB_POSTGRESDB_SSL_ENABLED="true"
# DB_POSTGRESDB_SSL_REJECT_UNAUTHORIZED="false"  # se seu Postgres usar CA self-signed

# Fila (Valkey)
QUEUE_BULL_REDIS_HOST="${Valkey.HOST}"
QUEUE_BULL_REDIS_PORT="${Valkey.PORT}"
QUEUE_BULL_REDIS_PASSWORD="${Valkey.PASSWORD}"
# QUEUE_BULL_REDIS_DB="2"       # opcional, se quiser separar DB lógico
QUEUE_BULL_REDIS_DUALSTACK="true"
# QUEUE_BULL_REDIS_TLS="true"   # se sua instância exigir TLS

# Higiene / Libs (opcional, do seu YAML)
EXECUTIONS_DATA_PRUNE="true"
EXECUTIONS_DATA_MAX_AGE="336"
NODE_FUNCTION_ALLOW_BUILTIN="*"
NODE_FUNCTION_ALLOW_EXTERNAL="moment,lodash"
N8N_COMMUNITY_PACKAGES_ENABLED="true"
N8N_REINSTALL_MISSING_PACKAGES="true"

# Rede
N8N_LISTEN_ADDRESS="0.0.0.0"
PORT="5678"
# (Opcional recomendado)
# N8N_DISABLE_PRODUCTION_MAIN_PROCESS="true"  # evita servir webhooks pelo main

# ===== Segurança (recomendado) =====
N8N_SECURE_COOKIE=true
N8N_PUBLIC_API_DISABLED=true
N8N_PUBLIC_API_SWAGGERUI_DISABLED=true

# ===== (Opcional) SMTP para convites/reset de senha =====
# N8N_EMAIL_MODE=smtp
# N8N_SMTP_HOST=...
# N8N_SMTP_PORT=587
# N8N_SMTP_USER=...
# N8N_SMTP_PASS=...
# N8N_SMTP_SENDER=Seu Nome <no-reply@seudominio.com>

openssl s_client -showcerts -connect postgres.railway.internal:5432 </dev/null